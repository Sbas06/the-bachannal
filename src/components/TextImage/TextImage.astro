---
import { Image } from 'astro:assets';
import '@/components/TextImage/textImage.css';
import type { TextImage } from '@/types/types';
import Gradient from '@/components/Gradient/Gradient.astro';

const {
  direction,
  content,
  hasGradient,
}: {
  direction?: 'flex-row' | 'flex-row-reverse';
  content?: TextImage;
  hasGradient?: boolean;
} = Astro.props;

const currentLang = Astro.currentLocale ?? 'es';

// Carga todas las traducciones bajo /src/i18n (build-time)
const translations = import.meta.glob('/src/i18n/*.ts', { eager: true }) as Record<string, any>;
const messages =
  translations[`/src/i18n/${currentLang}.ts`]?.default
  ?? translations[`/src/i18n/${currentLang}.js`]?.default
  ?? {};

  // Helper: obtiene la traducciÃ³n si existe, si no devuelve el fallback (valor en content)
const getTranslation = (field: keyof TI) => {
  const id = content?.id;
  if (!id) return content?.[field] ?? '';
  const translated = messages?.textImage?.[id]?.[field as string];
  return translated ?? content?.[field] ?? '';
};
---

<Gradient
  as='section'
  containerClass='relative flex h-[100dvh] justify-center'
  hasGradient={hasGradient}
>
  <div class={`flex ${direction} items-center justify-center xl:gap-x-20 2xl:gap-x-28`}>
    {
      content?.image && (
        <Image
          src={content.image}
          alt={getTranslation('alt')}
          width={content.width}
          height={content.height}
          class='1xl:max-w-[550px] lg:max-w-[512px] 2xl:max-w-[700px]'
        />
      )
    }

    <div>
      <div class='flex flex-col items-center 2xl:w-[590px]'>
        <h2 class='text-center'>
          <span class='font-koulen text-[40px]'>{getTranslation('title')}</span>
          <p class='font-whitehella text-gradient-bacchanal text-[50px] leading-[2.2]'>
            {getTranslation('highlightText')}
          </p>
        </h2>

        <p class='max-w-[500px] text-center text-balance'>
          {getTranslation('complementInfo')}
        </p>
      </div>
    </div>
  </div>

  <svg
    class='waves'
    viewBox='0 0 600 600'
    xmlns='http://www.w3.org/2000/svg'
    preserveAspectRatio='xMidYMid meet'
  >
    <defs>
      <linearGradient id='waveGradient' x1='0%' y1='0%' x2='100%' y2='100%'>
        <stop offset='0%' stop-color='#fff' stop-opacity='0.3'></stop>
        <stop offset='50%' stop-color='#fff' stop-opacity='0.2'></stop>
        <stop offset='100%' stop-color='#fff' stop-opacity='0.1'></stop>
      </linearGradient>
    </defs>

    <circle
      cx='300'
      cy='300'
      r='50'
      fill='none'
      stroke='url(#waveGradient)'
      stroke-width='2'
      class='animate-wave-1'></circle>

    <circle
      cx='300'
      cy='300'
      r='80'
      fill='none'
      stroke='url(#waveGradient)'
      stroke-width='1.5'
      class='animate-wave-2'></circle>

    <circle
      cx='300'
      cy='300'
      r='110'
      fill='none'
      stroke='url(#waveGradient)'
      stroke-width='1'
      class='animate-wave-3'></circle>

    <circle
      cx='300'
      cy='300'
      r='140'
      fill='none'
      stroke='url(#waveGradient)'
      stroke-width='0.5'
      class='animate-wave-4'></circle>

    <circle
      cx='300'
      cy='300'
      r='170'
      fill='none'
      stroke='url(#waveGradient)'
      stroke-width='0.3'
      class='animate-wave-5'></circle>
  </svg>
</Gradient>
